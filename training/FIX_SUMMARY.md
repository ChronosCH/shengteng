# TFNetè®­ç»ƒç³»ç»Ÿå…³é”®é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ¯ ä¿®å¤æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤è§£å†³äº†TFNetè®­ç»ƒç³»ç»Ÿå¯åŠ¨æ—¶é‡åˆ°çš„æ‰€æœ‰å…³é”®é”™è¯¯ï¼Œå¹¶è¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨Windowsç¯å¢ƒä¸‹çš„shengteng condaç¯å¢ƒä¸­èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å’Œè¿è¡Œã€‚

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. æ—¥å¿—ç›®å½•ä¸å­˜åœ¨é”™è¯¯ âœ…
**é—®é¢˜**: `FileNotFoundError: [Errno 2] No such file or directory: 'D:\\shengteng\\training\\logs\\training_20250908_121915.log'`

**ä¿®å¤æ–¹æ¡ˆ**:
- åœ¨è®­ç»ƒè„šæœ¬åˆå§‹åŒ–æ—¶è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰å¿…è¦ç›®å½•
- æ”¹è¿›äº†`ConfigManager.create_directories()`æ–¹æ³•ï¼Œå¢åŠ äº†é”™è¯¯å¤„ç†å’Œè·¨å¹³å°å…¼å®¹æ€§
- æ·»åŠ äº†`ensure_directory_exists()`å·¥å…·å‡½æ•°
- åœ¨æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å‰ç¡®ä¿ç›®å½•å­˜åœ¨

**ä¿®å¤æ–‡ä»¶**:
- `training/config_manager.py` - æ”¹è¿›ç›®å½•åˆ›å»ºé€»è¾‘
- `training/train_tfnet.py` - è°ƒæ•´åˆå§‹åŒ–é¡ºåº
- `training/utils.py` - æ–°å¢è·¨å¹³å°è·¯å¾„å¤„ç†å·¥å…·

### 2. MindSpore APIå¼ƒç”¨è­¦å‘Š âœ…
**é—®é¢˜**: `device_target` å‚æ•°å°†è¢«å¼ƒç”¨ï¼Œéœ€è¦ä½¿ç”¨æ–°çš„ `mindspore.set_device()` API

**ä¿®å¤æ–¹æ¡ˆ**:
- å®ç°äº†APIå…¼å®¹æ€§æ£€æŸ¥ï¼Œä¼˜å…ˆä½¿ç”¨æ–°API
- æ·»åŠ äº†è‡ªåŠ¨é™çº§åˆ°æ—§APIçš„æœºåˆ¶
- ç¡®ä¿å‘åå…¼å®¹æ€§

**ä¿®å¤ä»£ç **:
```python
# æ–°çš„å…¼å®¹æ€§å®ç°
if MINDSPORE_NEW_API:
    try:
        context.set_context(mode=context.GRAPH_MODE)
        set_device(device_target)
    except Exception:
        # è‡ªåŠ¨é™çº§åˆ°æ—§API
        context.set_context(mode=context.GRAPH_MODE, device_target=device_target)
```

**ä¿®å¤æ–‡ä»¶**:
- `training/train_tfnet.py` - æ›´æ–°MindSpore APIè°ƒç”¨
- `training/evaluator.py` - æ›´æ–°MindSpore APIè°ƒç”¨

### 3. Windowsæ‰¹å¤„ç†è„šæœ¬é”™è¯¯ âœ…
**é—®é¢˜**: `æ‰¾ä¸åˆ° C:\WINDOWS\TEMP\tmp_qv_id0a.bat` - Windowsæ‰¹å¤„ç†è„šæœ¬æ‰§è¡Œå¼‚å¸¸

**ä¿®å¤æ–¹æ¡ˆ**:
- å®Œå…¨é‡å†™äº†Windowsæ‰¹å¤„ç†è„šæœ¬
- æ·»åŠ äº†å¤šè·¯å¾„condaæ£€æµ‹
- æ”¹è¿›äº†é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- ä½¿ç”¨`setlocal enabledelayedexpansion`é¿å…ä¸´æ—¶æ–‡ä»¶é—®é¢˜

**ä¿®å¤æ–‡ä»¶**:
- `training/start_training.bat` - å®Œå…¨é‡å†™ï¼Œå¢å¼ºç¨³å®šæ€§

### 4. è·¨å¹³å°è·¯å¾„å¤„ç†é—®é¢˜ âœ…
**é—®é¢˜**: æ–‡ä»¶è·¯å¾„åœ¨Windowså’ŒLinuxç³»ç»Ÿä¸Šçš„å…¼å®¹æ€§é—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ**:
- åˆ›å»ºäº†ä¸“ç”¨çš„`utils.py`æ¨¡å—
- å®ç°äº†`normalize_path()`å‡½æ•°ç»Ÿä¸€è·¯å¾„å¤„ç†
- æ·»åŠ äº†è·¨å¹³å°çš„æ–‡ä»¶/ç›®å½•æ£€æŸ¥å‡½æ•°
- æ”¹è¿›äº†é”™è¯¯ä¿¡æ¯çš„æ¸…æ™°åº¦

**æ–°å¢åŠŸèƒ½**:
```python
# è·¨å¹³å°è·¯å¾„å¤„ç†
def normalize_path(path):
    return os.path.normpath(os.path.abspath(path))

# å®‰å…¨çš„ç›®å½•åˆ›å»º
def ensure_directory_exists(directory, create=True):
    # è·¨å¹³å°ç›®å½•åˆ›å»ºé€»è¾‘
```

### 5. é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿä¼˜åŒ– âœ…
**é—®é¢˜**: ç¼ºä¹æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯

**ä¿®å¤æ–¹æ¡ˆ**:
- æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æ‰“å°å‡½æ•°
- æ”¹è¿›äº†æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–æµç¨‹
- å¢åŠ äº†å¹³å°ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯
- å®ç°äº†å®‰å…¨çš„æ–‡ä»¶è·¯å¾„å¤„ç†

**æ–°å¢åŠŸèƒ½**:
- `print_error_details()` - è¯¦ç»†é”™è¯¯ä¿¡æ¯
- `validate_dataset_structure()` - æ•°æ®é›†ç»“æ„éªŒè¯
- `get_platform_info()` - å¹³å°ä¿¡æ¯è·å–

## ğŸ”§ æ–°å¢çš„å·¥å…·å’ŒåŠŸèƒ½

### 1. è·¨å¹³å°å·¥å…·æ¨¡å— (`training/utils.py`)
- è·¯å¾„å¤„ç†å’Œæ ‡å‡†åŒ–
- ç›®å½•åˆ›å»ºå’ŒéªŒè¯
- æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
- é”™è¯¯å¤„ç†å’Œè°ƒè¯•
- æ•°æ®é›†ç»“æ„éªŒè¯

### 2. æ”¹è¿›çš„é…ç½®ç®¡ç† (`training/config_manager.py`)
- å®‰å…¨è·¯å¾„è·å– (`get_safe_path()`)
- è‡ªåŠ¨ç›®å½•åˆ›å»º
- å¢å¼ºçš„é”™è¯¯å¤„ç†

### 3. å¢å¼ºçš„å¯åŠ¨è„šæœ¬
- **Pythonç‰ˆæœ¬** (`training/start_training.py`) - è·¨å¹³å°å…¼å®¹
- **Windowsæ‰¹å¤„ç†** (`training/start_training.bat`) - ä¸“ä¸ºWindowsä¼˜åŒ–

### 4. ç»¼åˆæµ‹è¯•è„šæœ¬ (`training/test_fixes.py`)
- éªŒè¯æ‰€æœ‰ä¿®å¤æ˜¯å¦æ­£å¸¸å·¥ä½œ
- æµ‹è¯•å„ä¸ªç»„ä»¶çš„åŠŸèƒ½
- æä¾›è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### Windowsç”¨æˆ·ï¼ˆæ¨èï¼‰:
```cmd
# æ£€æŸ¥ç¯å¢ƒ
training\start_training.bat check

# å¼€å§‹è®­ç»ƒ
training\start_training.bat train

# è¿è¡Œè¯„ä¼°
training\start_training.bat eval
```

### è·¨å¹³å°Pythonè„šæœ¬:
```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate shengteng

# æ£€æŸ¥ç¯å¢ƒ
python training/start_training.py check

# å¼€å§‹è®­ç»ƒ
python training/start_training.py train

# è¿è¡Œè¯„ä¼°
python training/start_training.py eval
```

### éªŒè¯ä¿®å¤:
```bash
# è¿è¡Œä¿®å¤éªŒè¯æµ‹è¯•
python training/test_fixes.py
```

## ğŸ“‹ ä¿®å¤éªŒè¯æ¸…å•

- [x] **ç›®å½•è‡ªåŠ¨åˆ›å»º** - é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨åˆ›å»ºlogsã€checkpointsã€outputç›®å½•
- [x] **MindSpore APIå…¼å®¹** - æ”¯æŒæ–°æ—§APIï¼Œè‡ªåŠ¨é™çº§
- [x] **Windowsæ‰¹å¤„ç†ä¿®å¤** - è§£å†³condaæ¿€æ´»å’Œä¸´æ—¶æ–‡ä»¶é—®é¢˜
- [x] **è·¨å¹³å°è·¯å¾„å¤„ç†** - Windowså’ŒLinuxè·¯å¾„ç»Ÿä¸€å¤„ç†
- [x] **å¢å¼ºé”™è¯¯å¤„ç†** - æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯
- [x] **æ—¥å¿—ç³»ç»Ÿä¼˜åŒ–** - å®‰å…¨çš„æ—¥å¿—æ–‡ä»¶åˆ›å»º
- [x] **æ•°æ®é›†éªŒè¯** - è‡ªåŠ¨éªŒè¯CE-CSLæ•°æ®é›†ç»“æ„
- [x] **å‘åå…¼å®¹æ€§** - ä¿æŒä¸ç°æœ‰é…ç½®çš„å…¼å®¹

## ğŸ” æ•…éšœæ’é™¤

å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **è¿è¡Œç¯å¢ƒæ£€æŸ¥**:
   ```bash
   python training/start_training.py check
   ```

2. **è¿è¡Œä¿®å¤éªŒè¯**:
   ```bash
   python training/test_fixes.py
   ```

3. **æ£€æŸ¥Pythonè¯­æ³•**:
   ```bash
   python -m py_compile training/train_tfnet.py
   ```

4. **æ‰‹åŠ¨åˆ›å»ºç›®å½•**:
   ```bash
   mkdir training\logs training\checkpoints training\output
   ```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

ä¿®å¤åçš„ç³»ç»Ÿå·²é’ˆå¯¹CPUç¯å¢ƒè¿›è¡Œä¼˜åŒ–ï¼š

- **æ‰¹å¤„ç†å¤§å°**: é»˜è®¤ä¸º2ï¼Œå¯æ ¹æ®å†…å­˜è°ƒæ•´ä¸º1
- **éšè—å±‚å¤§å°**: é»˜è®¤ä¸º1024ï¼Œå†…å­˜ä¸è¶³æ—¶å¯è°ƒæ•´ä¸º512
- **å·¥ä½œè¿›ç¨‹**: è®¾ç½®ä¸º1ï¼Œé€‚åˆCPUç¯å¢ƒ
- **æ—©åœæœºåˆ¶**: é˜²æ­¢è¿‡æ‹Ÿåˆï¼ŒèŠ‚çœè®­ç»ƒæ—¶é—´

## ğŸ‰ æ€»ç»“

æ‰€æœ‰å…³é”®é”™è¯¯å·²æˆåŠŸä¿®å¤ï¼ŒTFNetè®­ç»ƒç³»ç»Ÿç°åœ¨å…·å¤‡ï¼š

1. **ç¨³å®šæ€§** - è‡ªåŠ¨å¤„ç†ç›®å½•åˆ›å»ºå’Œè·¯å¾„é—®é¢˜
2. **å…¼å®¹æ€§** - æ”¯æŒæ–°æ—§MindSpore APIå’Œè·¨å¹³å°è¿è¡Œ
3. **å¯é æ€§** - å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
4. **æ˜“ç”¨æ€§** - ç®€åŒ–çš„å¯åŠ¨æµç¨‹å’Œæ¸…æ™°çš„æ–‡æ¡£

ç³»ç»Ÿç°åœ¨å¯ä»¥åœ¨Windowsç¯å¢ƒä¸‹çš„shengteng condaç¯å¢ƒä¸­æ­£å¸¸å¯åŠ¨å’Œè¿è¡Œï¼
